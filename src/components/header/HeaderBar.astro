---
import SearchInput from "./SearchInput.astro";
import WorkspaceSelector from "./WorkspaceSelector.astro";
import EnvironmentSelector from "./EnvironmentSelector";
import homeIcon from "../../assets/icons/home.svg?raw";
import settingsIcon from "../../assets/icons/settings.svg?raw";
import bellIcon from "../../assets/icons/bell.svg?raw";
import menuIcon from "../../assets/icons/menu.svg?raw";
---

<header class="h-12 bg-pm-bg-header border-b border-pm-border px-4 flex items-center justify-between">
	<!-- Hamburger menu (visible only on mobile/tablet) -->
	<button
		type="button"
		class="lg:hidden inline-flex items-center justify-center w-8 h-8 rounded hover:bg-pm-bg-elevated transition-colors text-pm-text-secondary"
		aria-label="Toggle sidebar"
		id="sidebar-toggle-mobile"
	>
		<div class="w-5 h-5" aria-hidden="true">
			<Fragment set:html={menuIcon} />
		</div>
	</button>

	<!-- Left section: Logo, Home, Workspace, API Network -->
	<div class="flex items-center gap-2 md:gap-4">
		<h1 class="text-lg font-bold text-pm-accent">queryBox</h1>

		<button
			type="button"
			class="hidden md:inline-flex items-center justify-center w-8 h-8 rounded hover:bg-pm-bg-elevated transition-colors text-pm-text-secondary"
			aria-label="Home"
		>
			<div class="w-5 h-5" aria-hidden="true">
				<Fragment set:html={homeIcon} />
			</div>
		</button>

		<div class="hidden md:block">
			<WorkspaceSelector />
		</div>

		<a
			href="#"
			class="hidden lg:block text-sm text-pm-text-secondary hover:text-pm-text-primary transition-colors"
		>
			API Network
		</a>
	</div>

	<!-- Center section: Search (hidden on mobile) -->
	<div class="hidden md:flex flex-1 max-w-md mx-8">
		<SearchInput />
	</div>

	<!-- Right section: Environment selector, Settings, Notifications, Avatar -->
	<div class="flex items-center gap-2">
		<EnvironmentSelector client:load />

		<button
			type="button"
			class="hidden md:inline-flex items-center justify-center w-8 h-8 rounded hover:bg-pm-bg-elevated transition-colors text-pm-text-secondary"
			aria-label="Settings"
		>
			<div class="w-5 h-5" aria-hidden="true">
				<Fragment set:html={settingsIcon} />
			</div>
		</button>

		<button
			type="button"
			class="hidden md:inline-flex items-center justify-center w-8 h-8 rounded hover:bg-pm-bg-elevated transition-colors text-pm-text-secondary"
			aria-label="Notifications"
		>
			<div class="w-5 h-5" aria-hidden="true">
				<Fragment set:html={bellIcon} />
			</div>
		</button>

		<button
			type="button"
			class="w-8 h-8 rounded-full bg-pm-accent flex items-center justify-center text-white text-sm font-semibold hover:bg-pm-accent-hover transition-colors"
			aria-label="User profile"
		>
			QU
		</button>
	</div>
</header>

<script>
	// Mobile sidebar toggle
	const toggleBtn = document.getElementById("sidebar-toggle-mobile");
	const sidebar = document.querySelector("aside");
	const backdrop = document.getElementById("sidebar-backdrop");

	if (toggleBtn && sidebar && backdrop) {
		toggleBtn.addEventListener("click", () => {
			const isOpen = sidebar.classList.contains("mobile-open");

			if (isOpen) {
				sidebar.classList.remove("mobile-open");
				backdrop.classList.add("hidden");
			} else {
				sidebar.classList.add("mobile-open");
				backdrop.classList.remove("hidden");
			}
		});

		// Close sidebar when clicking backdrop
		backdrop.addEventListener("click", () => {
			sidebar.classList.remove("mobile-open");
			backdrop.classList.add("hidden");
		});
	}
</script>
