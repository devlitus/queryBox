---
import { mockHistory } from "../../data/mock-history";
import HistoryItem from "./HistoryItem.astro";

// Group history by date
function groupByDate(entries: typeof mockHistory) {
	const now = new Date();
	const today: typeof mockHistory = [];
	const yesterday: typeof mockHistory = [];
	const older: typeof mockHistory = [];

	entries.forEach((entry) => {
		const diffMs = now.getTime() - entry.timestamp.getTime();
		const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));

		if (diffDays === 0) {
			today.push(entry);
		} else if (diffDays === 1) {
			yesterday.push(entry);
		} else {
			older.push(entry);
		}
	});

	return { today, yesterday, older };
}

const grouped = groupByDate(mockHistory);
---

<div class="py-2">
	{grouped.today.length > 0 && (
		<div class="mb-3">
			<div class="px-3 py-1 text-xs font-semibold text-pm-text-tertiary uppercase">Today</div>
			{grouped.today.map((entry) => (
				<HistoryItem
					method={entry.method}
					url={entry.url}
					timestamp={entry.timestamp}
					status={entry.status}
				/>
			))}
		</div>
	)}

	{grouped.yesterday.length > 0 && (
		<div class="mb-3">
			<div class="px-3 py-1 text-xs font-semibold text-pm-text-tertiary uppercase">Yesterday</div>
			{grouped.yesterday.map((entry) => (
				<HistoryItem
					method={entry.method}
					url={entry.url}
					timestamp={entry.timestamp}
					status={entry.status}
				/>
			))}
		</div>
	)}

	{grouped.older.length > 0 && (
		<div>
			<div class="px-3 py-1 text-xs font-semibold text-pm-text-tertiary uppercase">Older</div>
			{grouped.older.map((entry) => (
				<HistoryItem
					method={entry.method}
					url={entry.url}
					timestamp={entry.timestamp}
					status={entry.status}
				/>
			))}
		</div>
	)}
</div>
